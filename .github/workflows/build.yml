- name: Generate Native iOS Code
        run: npx expo prebuild --platform ios --clean --no-install --non-interactive

      - name: Install CocoaPods
        run: |
          cd ios
          pod install
          cd ..

      - name: Force Fix Node Path
        run: |
          NODE_PATH=$(command -v node)
          echo "export NODE_BINARY=$NODE_PATH" > ios/.xcode.env
          echo "export NODE_BINARY=$NODE_PATH" > ios/.xcode.env.local
          sudo ln -s $NODE_PATH /usr/local/bin/node || true

      - name: Build for Real Device (iPhone)
        run: |
          # The pod install step above creates the .xcworkspace
          WORKSPACE=$(ls ios/*.xcworkspace | head -1)
          SCHEME=$(basename "$WORKSPACE" .xcworkspace)
          
          echo "Building Workspace: $WORKSPACE with Scheme: $SCHEME"

          xcodebuild \
            -workspace "$WORKSPACE" \
            -scheme "$SCHEME" \
            -configuration Release \
            -sdk iphoneos \
            -derivedDataPath ios/build \
            CODE_SIGNING_ALLOWED=NO \
            CODE_SIGNING_REQUIRED=NO \
            CODE_SIGNING_IDENTITY="" \
            AD_HOC_CODE_SIGNING_ALLOWED=YES
